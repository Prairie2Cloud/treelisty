{
  "id": "self-tree-v17",
  "name": "TreeListy Self-Tree v1.7",
  "description": "**Lens Selection**\n- Primary: Capability (What can I do?)\n- Secondary: Gap (What's missing?)\n- Tertiary: Meta (Is self-tree process improving?)\n\n**Build:** 856\n**Date:** 2026-01-14\n**Evidence Standard:** v1.7 (living dashboard with actionable metrics)\n\n**v1.7 Improvements:**\n- Populated Now/Next/Later with concrete actions\n- Added specific metrics to Measured Signals\n- Added Improvement Suggestions with architecture wins\n- Self-tree now drives weekly decisions",
  "pattern": "knowledge-base",
  "children": [
    {
      "id": "measured-signals",
      "name": "Measured Signals",
      "description": "**Live Dashboard** - Automated measurements from Build 856\nLast run: 2026-01-14T22:31:32.396Z\n\n| Metric | Value | Trend |\n|--------|-------|-------|\n| File Size | 5.23 MB | +32% since B543 |\n| Lines | 110,946 | +44% since B543 |\n| Tests | 494 passing | Stable |\n| Views | 11 | All core views |\n| Features | 15/15 | All implemented |",
      "items": [
        {
          "id": "signal-size",
          "name": "File Metrics",
          "description": "**5.23 MB | 110,946 lines** [MEASURED]\n\n| Component | Lines | % of Total |\n|-----------|-------|------------|\n| CSS | ~10,000 | 11% |\n| HTML | ~3,000 | 3% |\n| JavaScript | ~80,000 | 86% |\n\n**Trend:** +32% size since Build 543 (was 3.36 MB)\n**Health:** ⚠️ Watch for performance - consider code splitting if >5MB"
        },
        {
          "id": "signal-tests",
          "name": "Unit Tests",
          "description": "**494 tests passing** ✅ [MEASURED]\n\n| Suite | Tests | Status |\n|-------|-------|--------|\n| Core Functions | 120+ | ✅ Pass |\n| Tree Operations | 80+ | ✅ Pass |\n| View Rendering | 60+ | ✅ Pass |\n| Import/Export | 40+ | ✅ Pass |\n| Patterns | 21 | ✅ Pass |\n\n**Coverage:** ~60% of critical paths\n**CI:** ✅ E2E Playwright tests in GitHub Actions (smoke, TB caps, live site)\n**Run:** `cd test/treelisty-test && npm run test:unit`"
        },
        {
          "id": "signal-views",
          "name": "View Modes",
          "description": "**11 views implemented** [MEASURED]\n\n| View | Status | Library |\n|------|--------|---------|\n| Tree | ✅ Core | Vanilla JS |\n| Canvas | ✅ Core | GoJS |\n| 3D | ✅ Core | Three.js |\n| Gantt | ✅ Core | Frappe Gantt |\n| Calendar | ✅ Core | FullCalendar |\n| Mind Map | ✅ New | Vanilla JS |\n| Treemap | ✅ Viz | D3.js |\n| Checklist | ✅ New | Vanilla JS |\n| Kanban | ✅ New | Vanilla JS |\n| Embed | ✅ Mode | - |\n| Readonly | ✅ Mode | - |\n\n**Detected views:** readonly, embed, gantt, calendar, treemap, mindmap, checklist, kanban, canvas, 3d, tree"
        },
        {
          "id": "signal-keyboard",
          "name": "Keyboard Shortcuts",
          "description": "**52 keyboard handlers** [MEASURED]\n\n| Category | Shortcuts | Examples |\n|----------|-----------|----------|\n| Navigation | 12 | ↑↓←→, Tab, Enter |\n| Views | 6 | Ctrl+1-6 for views |\n| Actions | 15 | Ctrl+Z, Ctrl+S, Del |\n| TreeBeard | 5 | Ctrl+/, Ctrl+Enter |\n| Misc | 6 | Esc, F2, etc |\n\n**Discoverability:** ✅ Press ? for shortcut overlay (Build 742), searchable (Build 810)"
        },
        {
          "id": "signal-window",
          "name": "Window API",
          "description": "**488 window-exposed functions** [MEASURED]\n\n| Category | Count | Key Functions |\n|----------|-------|---------------|\n| Render | 6 | render, renderCanvas, render3D... |\n| Data | 5 | capexTree, saveState, loadTree... |\n| UI | 10 | showToast, showModal... |\n| Atlas | 4 | TreeRegistry.* |\n| Gallery | 3 | SubmissionInbox.* |\n| Firebase | 20+ | firebaseApp, firebaseDb... |\n\n**For MCP Bridge:** All critical functions exposed ✅"
        }
      ]
    },
    {
      "id": "verified-features",
      "name": "Verified Features",
      "description": "Features confirmed present in codebase via pattern matching",
      "items": [
        {
          "id": "feature-0",
          "name": "Gallery (SubmissionInbox)",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        },
        {
          "id": "feature-1",
          "name": "Atlas (TreeRegistry)",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        },
        {
          "id": "feature-2",
          "name": "Focus Mode",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        },
        {
          "id": "feature-3",
          "name": "Mind Map",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        },
        {
          "id": "feature-4",
          "name": "TTS (speakNode)",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        },
        {
          "id": "feature-5",
          "name": "Chrome Extension",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        },
        {
          "id": "feature-6",
          "name": "MCP Bridge",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        },
        {
          "id": "feature-7",
          "name": "Hyperedges",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        },
        {
          "id": "feature-8",
          "name": "Gantt View",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        },
        {
          "id": "feature-9",
          "name": "Calendar View",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        },
        {
          "id": "feature-10",
          "name": "3D View",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        },
        {
          "id": "feature-11",
          "name": "Canvas View",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        },
        {
          "id": "feature-12",
          "name": "Live Sync (Firebase)",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        },
        {
          "id": "feature-13",
          "name": "Image Analysis",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        },
        {
          "id": "feature-14",
          "name": "TB Structured Tool Use",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 856"
        }
      ]
    },
    {
      "id": "now-next-later",
      "name": "Now / Next / Later",
      "description": "Execution-forcing structure for Build 856.\n\n**Rule:** If \"Now\" is empty, the self-tree failed its purpose.\n**Updated:** 2026-01-14",
      "items": [
        {
          "id": "now",
          "name": "Now (This Week)",
          "description": "Max 3 items. Each has acceptance test. **Currently executing.**",
          "subtasks": [
            {
              "id": "now-1",
              "name": "1. Mobile Checklist Lifecycle",
              "description": "**Status:** ✅ Complete (Builds 823-829)\n**Acceptance Test:** Checklists work end-to-end on mobile.\n\n| Phase | Build | Feature | Status |\n|-------|-------|---------|--------|\n| 1 | 823 | Checklist View | ✅ Done |\n| 2 | 826 | Mobile Tree Picker | ✅ Done |\n| 3 | 827 | Auto-Archive on 100% | ✅ Done |\n| 4 | 828 | Recurring Detection | ✅ Done |\n| 5 | 829 | Hide Node Checkboxes | ✅ Done |\n\n**Completed:** 2026-01-12. Full checklist lifecycle with recurrence."
            },
            {
              "id": "now-2",
              "name": "2. Kanban View",
              "description": "**Status:** ✅ Complete (Builds 839-846)\n**Acceptance Test:** Drag tasks between columns, status updates.\n\n| Phase | Build | Feature | Status |\n|-------|-------|---------|--------|\n| 1 | 839 | Kanban View (11th view) | ✅ Done |\n| 2 | 844 | Sidebar offset fix | ✅ Done |\n| 3 | 846 | View switching + descriptions | ✅ Done |\n\n**Completed:** 2026-01-13. 4-column board with drag-drop and depth selector."
            },
            {
              "id": "now-3",
              "name": "3. Calendar Todo Lens",
              "description": "**Status:** ✅ Complete (Builds 817-856)\n**Acceptance Test:** NL date parsing, drag-drop reschedule.\n\n| Phase | Build | Feature | Status |\n|-------|-------|---------|--------|\n| 1 | 817 | Foundation (getNodeSchedule) | ✅ Done |\n| 2 | 818-820 | Daily Cockpit (Today Panel) | ✅ Done |\n| 3 | 856 | NL Date Parser + Confidence | ✅ Done |\n| 4 | 856 | Drag-drop reschedule | ✅ Done |\n\n**Completed:** 2026-01-14. Constitutional Article IV routing implemented."
            }
          ]
        },
        {
          "id": "next",
          "name": "Next (This Month)",
          "description": "Max 5 items. Pending validation. Ordered by impact.",
          "subtasks": [
            {
              "id": "next-1",
              "name": "1. Dashboard Trees (Morning Dashboard)",
              "description": "**Goal:** Unified view of Gmail/GDrive/Calendar with AI summary.\n**Effort:** High (multi-build feature)\n**Design Doc:** `docs/plans/2026-01-05-dashboard-trees-design.md`\n**Key Features:**\n- DashboardConnector abstraction for data sources\n- Stable external IDs across refreshes\n- Agentic workflows (monitor → wait → act)\n- Auto-draft with approval flow"
            },
            {
              "id": "next-2",
              "name": "2. TB Awareness System",
              "description": "**Goal:** TreeBeard becomes self-aware and proactive.\n**Effort:** Medium (phased implementation)\n**Design Doc:** `docs/plans/2026-01-03-tb-awareness-system-design.md`\n**Key Features:**\n- Session stats, tree health monitoring\n- Frustration detection\n- Proactive suggestions based on context\n- App-side decision engine (minimal prompt injection)"
            },
            {
              "id": "next-3",
              "name": "3. Self-Tree Auto-Update CI Job",
              "description": "**Hypothesis:** Weekly automated measurement updates will keep self-tree fresh.\n**Effort:** Low (GitHub Action + cron)\n**Validation:** Run for 4 weeks, check accuracy.\n\n```yaml\n# .github/workflows/self-tree-update.yml\non:\n  schedule:\n    - cron: '0 0 * * 0'  # Weekly Sunday\n```"
            },
            {
              "id": "next-4",
              "name": "4. TreeBeard Telemetry Dashboard",
              "description": "**Hypothesis:** Command usage data will inform priority decisions.\n**Effort:** Medium\n**Prerequisite:** getToolUseTelemetry() already implemented.\n**Validation:** Track for 2 weeks, identify top 10 commands."
            }
          ]
        },
        {
          "id": "later",
          "name": "Later",
          "description": "Parking lot. Revisit when priorities shift.",
          "subtasks": [
            {
              "id": "later-1",
              "name": "Local Whisper (WebAssembly)",
              "description": "Free offline transcription via whisper.cpp WASM.\n**Effort:** High (50+ hours)\n**Trade-off:** No API cost vs. large bundle size (~40MB)\n**Blocked by:** Whisper API integration (validate quality first)"
            },
            {
              "id": "later-2",
              "name": "Multi-Tree Workspaces",
              "description": "Open multiple trees in tabs.\n**Effort:** Very High\n**Trade-off:** Power feature vs. architecture complexity\n**Blocked by:** Single-file constraint (one capexTree global)"
            },
            {
              "id": "later-3",
              "name": "Code Splitting",
              "description": "Break 4.4MB file into lazy-loaded modules.\n**Trigger:** When file exceeds 5MB or Lighthouse < 50\n**Trade-off:** Performance vs. single-file portability"
            }
          ]
        }
      ]
    },
    {
      "id": "meta",
      "name": "Meta: Self-Tree Process",
      "description": "How well is the self-tree process working?",
      "items": [
        {
          "id": "meta-freshness",
          "name": "Freshness",
          "description": "**Current Build: 856** [MEASURED]\n\nLast measurement: 2026-01-14T22:31:32.396Z\nAuto-detection: generate-self-tree.js now finds latest measurements file.\nFix applied: Dynamic file discovery prevents staleness."
        },
        {
          "id": "meta-actionability",
          "name": "Actionability",
          "description": "**Now/Next/Later structure forces execution** [OBSERVED]\n\nv1.4 had good structure but stale content.\nv1.5 adds automated signals to ensure accuracy."
        },
        {
          "id": "meta-bootstrapping",
          "name": "Bootstrapping Value",
          "description": "**Self-tree enables AI context injection** [HYPOTHESIS]\n\nWhen Claude Code reads self-tree:\n- Understands current capabilities\n- Knows what's implemented vs planned\n- Can make informed development decisions\n\n**Validation:** Track time-to-productivity for new sessions."
        },
        {
          "id": "meta-bootstrap-loop",
          "name": "Bootstrap Loop Status",
          "description": "**Self-improvement cycle operational** [v1.7]\n\n| Cycle | Input | Output | Status |\n|-------|-------|--------|--------|\n| Measure | treeplexity.html | measurements.json | ✅ |\n| Generate | measurements.json | self-tree-v17.json | ✅ |\n| Import | self-tree | TreeListy UI | ✅ |\n| Analyze | TB Deep Mode | Improvement suggestions | ✅ |\n| Improve | Suggestions | Updated generate script | ✅ |\n\n**Iterations:** v1.4 → v1.5 → v1.6 → v1.7\n**Velocity:** 3 improvement cycles in one session"
        }
      ]
    },
    {
      "id": "improvements",
      "name": "Improvement Suggestions",
      "description": "Architecture wins identified by TreeBeard analysis.\n**Source:** bootstrap-self-tree.py runs\n**Purpose:** Track actionable improvements to TreeListy itself.\n**Last Updated:** 2026-01-14",
      "items": [
        {
          "id": "improve-1",
          "name": "✅ DONE: Keyboard Shortcut Overlay",
          "description": "**Completed:** Build 742 (overlay) + Build 810 (search + tooltips)\n**What shipped:**\n- Press ? to open shortcut modal\n- Search input filters shortcuts in real-time\n- CSS tooltips on toolbar buttons\n- Both ? and Shift+? work"
        },
        {
          "id": "improve-2",
          "name": "✅ DONE: E2E Tests in CI",
          "description": "**Completed:** e2e-tests.yml workflow\n**What shipped:**\n- Size budget check (5MB warn, 5.5MB fail)\n- Primary smoke tests\n- Gmail local search smoke test\n- TreeBeard capabilities tests\n- E2E tests against live site\n- Unit tests (494 passing)"
        },
        {
          "id": "improve-3",
          "name": "✅ DONE: Command Count Measurement",
          "description": "**Completed:** measure-self-tree.js fixed\n**What shipped:**\n- COMMAND_REGISTRY entries: 224\n- TB directMappings commands: 101\n- Regex properly parses complex object structure"
        },
        {
          "id": "improve-4",
          "name": "✅ DONE: Performance Budget CI",
          "description": "**Completed:** size-budget.yml workflow\n**What shipped:**\n- 5.0 MB warning threshold\n- 5.5 MB hard fail threshold\n- Summary report with progress bar\n- Recommendations when over budget\n**Current:** 5.23 MB (95% of limit)"
        }
      ]
    },
    {
      "id": "architecture",
      "name": "Architecture Quick Reference",
      "description": "Key facts for AI development context. Framework: **Vanilla JS** (no React/Vue/Angular).",
      "items": [
        {
          "id": "arch-structure",
          "name": "Single-File Structure",
          "description": "**treeplexity.html** (~4.4MB, ~94,000 lines)\n\n- HTML: ~2,000 lines (structure, modals, views)\n- CSS: ~10,000 lines (themes, responsive, animations)\n- JavaScript: ~80,000+ lines (all logic inline)\n\n**Framework:** Vanilla JavaScript - no build step required.\n**Why single-file:** Portability, offline use, no bundler complexity."
        },
        {
          "id": "arch-tree",
          "name": "Tree Data Model",
          "description": "**4-Level Hierarchy**\n\n```\nRoot (capexTree)\n├── Phase (children[])\n│   ├── Item (items[])\n│   │   └── Subtask (subtasks[])\n```\n\n**Key Variable:** `window.capexTree` - the entire tree state\n**Node types:** root, phase, item, subtask (MUST be one of these)\n**Semantic fields:** subtitle, tags, description (for categorization)"
        },
        {
          "id": "arch-entry-points",
          "name": "Entry Points & Command System",
          "description": "**Command Registration:**\n- `COMMAND_REGISTRY` object (~line 56000) - maps command names to handlers\n- `handlers` object in TreeBeard scope - individual command implementations\n- `routeToCapability()` - routes user intent to commands\n\n**Key Entry Functions:**\n- `render()` - re-render tree view\n- `renderCanvas()` - re-render canvas (GoJS)\n- `renderGantt()` - re-render Gantt (Frappe)\n- `saveState(desc)` - push to undo stack\n- `showToast(msg, type)` - user notifications\n\n**Event Handlers:**\n- DOMContentLoaded (~line 17000) - main initialization\n- Keyboard: `e.key` checks throughout for shortcuts\n- Context menus: right-click handlers per view"
        },
        {
          "id": "arch-data-flow",
          "name": "Data Flow & State",
          "description": "**State Management:** Direct mutation + re-render (no Redux/Vuex)\n\n```\nUser Action → Modify capexTree → saveState() → render*()\n```\n\n**View Sync Pattern:**\n1. `capexTree` is the single source of truth\n2. Each view has its own render function\n3. Views read from capexTree, never store separate state\n4. `normalizeTreeStructure()` ensures consistent format\n\n**Persistence:**\n- LocalStorage: `localStorage.getItem('capexTree')`\n- Cloud: Firebase Firestore (`shared/`, `syncRooms/`)\n- Export: JSON, Excel (SheetJS), MS Project XML"
        },
        {
          "id": "arch-ai-integration",
          "name": "AI Integration Points",
          "description": "**LLM Providers:**\n- Claude (Anthropic) - via Netlify proxy or direct\n- Gemini (Google) - direct browser calls\n- ChatGPT (OpenAI) - direct browser calls\n\n**Key AI Functions:**\n- `callClaudeAPI()` / `callClaudeStreamingAPI()` (~line 16000)\n- `callGeminiAPI()` (~line 16500)\n- `handleConversationWithStreaming()` - TreeBeard chat handler\n\n**API Key Management:**\n- `getLocalAPIKey(provider)` - reads from localStorage\n- Keys stored: `anthropic_api_key`, `gemini_api_key`, `openai_api_key`\n- Server key fallback via Netlify proxy (rate limited)\n\n**AI Response → Tree Operations:**\n- TreeBeard parses response for commands (add_child, focus_node, etc.)\n- `executeToolCall()` - structured tool use (Build 658+)\n- Commands modify capexTree directly"
        },
        {
          "id": "arch-dev-setup",
          "name": "Development Setup",
          "description": "**No Build Required** - just open treeplexity.html in browser\n\n**Local Development:**\n```bash\n# Option 1: Direct file\nopen treeplexity.html\n\n# Option 2: Local server (for some features)\nnpx serve .\n```\n\n**Testing:**\n```bash\ncd test/treelisty-test\nnpm install\nnpm run test:unit    # 494+ Vitest tests\n```\n\n**Deployment:**\n```bash\ngit add treeplexity.html\ngit commit -m \"Build XXX: Description\"\ngit push  # Netlify auto-deploys\n```\n\n**MCP Bridge (for Claude Code):**\n```bash\nnode packages/treelisty-mcp-bridge/src/bridge.js\n```"
        },
        {
          "id": "arch-key-locations",
          "name": "Key Code Locations",
          "description": "**By Line Number (approximate):**\n\n| Section | Lines | What's There |\n|---------|-------|--------------|\n| Header/Changelog | 1-1000 | Version history |\n| CSS Styles | 1000-11000 | All styling |\n| HTML Structure | 11000-14000 | Modals, views, layout |\n| Core Functions | 14000-20000 | render, save, load |\n| AI Integration | 15000-18000 | LLM calls, streaming |\n| TreeBeard | 55000-85000 | Chat, commands, tool use |\n| Canvas (GoJS) | 40000-50000 | 2D visualization |\n| Gantt (Frappe) | 50000-55000 | Timeline view |\n| Firebase Sync | 30000-35000 | Collaboration |\n\n**Key Searchable Patterns:**\n- `function render()` - tree view rendering\n- `COMMAND_REGISTRY` - all TB commands\n- `PATTERNS =` - pattern definitions\n- `TREELISTY_VERSION` - version info"
        },
        {
          "id": "arch-packages",
          "name": "Supporting Packages",
          "description": "**packages/**\n- `treelisty-mcp-bridge/` - Node.js MCP server for Claude Code\n- `treelisty-chrome-extension/` - Screen capture extension\n\n**netlify/functions/**\n- `claude-proxy.js` - Server-side API proxy (avoids CORS)\n\n**scripts/**\n- `measure-self-tree.js` - Gather codebase metrics\n- `generate-self-tree.js` - Create self-tree from measurements\n\n**test/**\n- `treelisty-test/` - Vitest unit tests (494+)\n- `*.py` - Playwright e2e tests"
        }
      ]
    }
  ]
}