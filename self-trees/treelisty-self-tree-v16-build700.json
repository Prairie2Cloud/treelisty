{
  "id": "self-tree-v16",
  "name": "TreeListy Self-Tree v1.6",
  "description": "**Lens Selection**\n- Primary: Capability (What can I do?)\n- Secondary: Gap (What's missing?)\n- Tertiary: Meta (Is self-tree process improving?)\n\n**Build:** 700\n**Date:** 2026-01-03\n**Evidence Standard:** v1.6 (automated measurement + TB-validated architecture)\n\n**v1.6 Improvements:**\n- Added Entry Points & Command System\n- Added Data Flow & State Management\n- Added AI Integration Points\n- Added Development Setup\n- Added Key Code Locations",
  "pattern": "knowledge-base",
  "children": [
    {
      "id": "measured-signals",
      "name": "Measured Signals",
      "description": "Automated measurements from Build 700\nLast run: 2026-01-03T07:45:50.953Z",
      "items": [
        {
          "id": "signal-size",
          "name": "File Metrics",
          "description": "**4.42 MB | 93,770 lines** [MEASURED]\n\nSingle-file architecture maintained.\n- Growth: +32% since Build 543\n- Method: fs.statSync + line count\n- Date: 2026-01-03"
        },
        {
          "id": "signal-tests",
          "name": "Unit Tests",
          "description": "**469 tests passing** [MEASURED]\n\nAll unit tests pass.\n- Method: npm run test:unit\n- Framework: Mocha\n- Date: 2026-01-03"
        },
        {
          "id": "signal-views",
          "name": "View Modes",
          "description": "**9 views** [MEASURED]\n\n- readonly\n- embed\n- gantt\n- calendar\n- treemap\n- mindmap\n- canvas\n- 3d\n- tree\n\nCore views: tree, canvas, 3d, gantt, calendar, mindmap\nSpecial modes: treemap, embed, readonly"
        },
        {
          "id": "signal-keyboard",
          "name": "Keyboard Handlers",
          "description": "**44 handlers** [MEASURED]\n\nKeyboard shortcuts for power users.\n- Growth: +11 since Build 543\n- Method: regex scan for e.key checks"
        },
        {
          "id": "signal-window",
          "name": "Window-Exposed Functions",
          "description": "**340 functions** [MEASURED]\n\nFunctions accessible from console/scripts.\n- Enables: MCP bridge, testing, debugging\n- Method: window.* assignment scan"
        }
      ]
    },
    {
      "id": "verified-features",
      "name": "Verified Features",
      "description": "Features confirmed present in codebase via pattern matching",
      "items": [
        {
          "id": "feature-0",
          "name": "Gallery (SubmissionInbox)",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        },
        {
          "id": "feature-1",
          "name": "Atlas (TreeRegistry)",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        },
        {
          "id": "feature-2",
          "name": "Focus Mode",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        },
        {
          "id": "feature-3",
          "name": "Mind Map",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        },
        {
          "id": "feature-4",
          "name": "TTS (speakNode)",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        },
        {
          "id": "feature-5",
          "name": "Chrome Extension",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        },
        {
          "id": "feature-6",
          "name": "MCP Bridge",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        },
        {
          "id": "feature-7",
          "name": "Hyperedges",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        },
        {
          "id": "feature-8",
          "name": "Gantt View",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        },
        {
          "id": "feature-9",
          "name": "Calendar View",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        },
        {
          "id": "feature-10",
          "name": "3D View",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        },
        {
          "id": "feature-11",
          "name": "Canvas View",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        },
        {
          "id": "feature-12",
          "name": "Live Sync (Firebase)",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        },
        {
          "id": "feature-13",
          "name": "Image Analysis",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        },
        {
          "id": "feature-14",
          "name": "TB Structured Tool Use",
          "description": "**PRESENT** [CODE-OBSERVED]\n\nFeature detection via regex pattern matching.\n- Status: ✅ Implemented\n- Build: 700"
        }
      ]
    },
    {
      "id": "now-next-later",
      "name": "Now / Next / Later",
      "description": "Execution-forcing structure.\n\n**Rule:** If \"Now\" is empty, the self-tree failed its purpose.",
      "items": [
        {
          "id": "now",
          "name": "Now (This Week)",
          "description": "Max 3 items. Each has acceptance test.",
          "subtasks": [
            {
              "id": "now-1",
              "name": "1. Update Self-Tree to v1.5",
              "description": "**Status:** In Progress\n**Acceptance Test:** Self-tree reflects Build 700 measurements.\n\n- [x] Create measurement script\n- [x] Run measurements\n- [ ] Generate v1.5 tree\n- [ ] Import and verify\n- [ ] Commit to repo"
            },
            {
              "id": "now-2",
              "name": "2. Verify Feature Documentation",
              "description": "**Status:** In Progress\n**Acceptance Test:** All documented features pass live tests.\n\n- [x] Create verify-features-v2.py\n- [x] Run 37 tests (all pass)\n- [ ] Add TreeBeard command tests\n- [ ] Add mobile viewport tests"
            },
            {
              "id": "now-3",
              "name": "3. Fix Command Count Measurement",
              "description": "**Status:** Pending\n**Acceptance Test:** Script correctly reports 120+ commands.\n\nCurrent issue: COMMAND_REGISTRY regex only finding 1 entry.\nNeed to fix pattern matching in measure-self-tree.js."
            }
          ]
        },
        {
          "id": "next",
          "name": "Next (This Month)",
          "description": "Max 5 items. Pending validation.",
          "subtasks": [
            {
              "id": "next-1",
              "name": "1. Whisper API Integration",
              "description": "**Hypothesis:** Whisper will produce better transcripts than Web Speech API.\n[SPECULATED] [ADAPTABLE]\n\nPlan exists: docs/plans/whisper-api-integration.md\n**Blocks:** Nothing currently blocked."
            },
            {
              "id": "next-2",
              "name": "2. Self-Tree Auto-Update",
              "description": "**Hypothesis:** Automated weekly measurement updates will keep self-tree fresh.\n[SPECULATED] [ADAPTABLE]\n\n**Validation:** Run for 4 weeks, check accuracy."
            },
            {
              "id": "next-3",
              "name": "3. TreeBeard Telemetry Dashboard",
              "description": "**Hypothesis:** Seeing command usage will inform priorities.\n[SPECULATED]\n\n**Prerequisite:** getToolUseTelemetry() already in place."
            }
          ]
        },
        {
          "id": "later",
          "name": "Later",
          "description": "Parking lot, not priority.",
          "subtasks": [
            {
              "id": "later-1",
              "name": "Local Whisper (WebAssembly)",
              "description": "Free offline transcription. Heavy implementation."
            },
            {
              "id": "later-2",
              "name": "Multi-Tree Workspaces",
              "description": "Open multiple trees in tabs. Requires architecture changes."
            }
          ]
        }
      ]
    },
    {
      "id": "meta",
      "name": "Meta: Self-Tree Process",
      "description": "How well is the self-tree process working?",
      "items": [
        {
          "id": "meta-freshness",
          "name": "Freshness",
          "description": "**v1.4 was 157 builds stale** [MEASURED]\n\nGap: Build 543 → Build 700 = 157 builds undocumented.\nRoot cause: Manual update process.\nFix: Automated measurement script (implemented)."
        },
        {
          "id": "meta-actionability",
          "name": "Actionability",
          "description": "**Now/Next/Later structure forces execution** [OBSERVED]\n\nv1.4 had good structure but stale content.\nv1.5 adds automated signals to ensure accuracy."
        },
        {
          "id": "meta-bootstrapping",
          "name": "Bootstrapping Value",
          "description": "**Self-tree enables AI context injection** [HYPOTHESIS]\n\nWhen Claude Code reads self-tree:\n- Understands current capabilities\n- Knows what's implemented vs planned\n- Can make informed development decisions\n\n**Validation:** Track time-to-productivity for new sessions."
        }
      ]
    },
    {
      "id": "architecture",
      "name": "Architecture Quick Reference",
      "description": "Key facts for AI development context. Framework: **Vanilla JS** (no React/Vue/Angular).",
      "items": [
        {
          "id": "arch-structure",
          "name": "Single-File Structure",
          "description": "**treeplexity.html** (~4.4MB, ~94,000 lines)\n\n- HTML: ~2,000 lines (structure, modals, views)\n- CSS: ~10,000 lines (themes, responsive, animations)\n- JavaScript: ~80,000+ lines (all logic inline)\n\n**Framework:** Vanilla JavaScript - no build step required.\n**Why single-file:** Portability, offline use, no bundler complexity."
        },
        {
          "id": "arch-tree",
          "name": "Tree Data Model",
          "description": "**4-Level Hierarchy**\n\n```\nRoot (capexTree)\n├── Phase (children[])\n│   ├── Item (items[])\n│   │   └── Subtask (subtasks[])\n```\n\n**Key Variable:** `window.capexTree` - the entire tree state\n**Node types:** root, phase, item, subtask (MUST be one of these)\n**Semantic fields:** subtitle, tags, description (for categorization)"
        },
        {
          "id": "arch-entry-points",
          "name": "Entry Points & Command System",
          "description": "**Command Registration:**\n- `COMMAND_REGISTRY` object (~line 56000) - maps command names to handlers\n- `handlers` object in TreeBeard scope - individual command implementations\n- `routeToCapability()` - routes user intent to commands\n\n**Key Entry Functions:**\n- `render()` - re-render tree view\n- `renderCanvas()` - re-render canvas (GoJS)\n- `renderGantt()` - re-render Gantt (Frappe)\n- `saveState(desc)` - push to undo stack\n- `showToast(msg, type)` - user notifications\n\n**Event Handlers:**\n- DOMContentLoaded (~line 17000) - main initialization\n- Keyboard: `e.key` checks throughout for shortcuts\n- Context menus: right-click handlers per view"
        },
        {
          "id": "arch-data-flow",
          "name": "Data Flow & State",
          "description": "**State Management:** Direct mutation + re-render (no Redux/Vuex)\n\n```\nUser Action → Modify capexTree → saveState() → render*()\n```\n\n**View Sync Pattern:**\n1. `capexTree` is the single source of truth\n2. Each view has its own render function\n3. Views read from capexTree, never store separate state\n4. `normalizeTreeStructure()` ensures consistent format\n\n**Persistence:**\n- LocalStorage: `localStorage.getItem('capexTree')`\n- Cloud: Firebase Firestore (`shared/`, `syncRooms/`)\n- Export: JSON, Excel (SheetJS), MS Project XML"
        },
        {
          "id": "arch-ai-integration",
          "name": "AI Integration Points",
          "description": "**LLM Providers:**\n- Claude (Anthropic) - via Netlify proxy or direct\n- Gemini (Google) - direct browser calls\n- ChatGPT (OpenAI) - direct browser calls\n\n**Key AI Functions:**\n- `callClaudeAPI()` / `callClaudeStreamingAPI()` (~line 16000)\n- `callGeminiAPI()` (~line 16500)\n- `handleConversationWithStreaming()` - TreeBeard chat handler\n\n**API Key Management:**\n- `getLocalAPIKey(provider)` - reads from localStorage\n- Keys stored: `anthropic_api_key`, `gemini_api_key`, `openai_api_key`\n- Server key fallback via Netlify proxy (rate limited)\n\n**AI Response → Tree Operations:**\n- TreeBeard parses response for commands (add_child, focus_node, etc.)\n- `executeToolCall()` - structured tool use (Build 658+)\n- Commands modify capexTree directly"
        },
        {
          "id": "arch-dev-setup",
          "name": "Development Setup",
          "description": "**No Build Required** - just open treeplexity.html in browser\n\n**Local Development:**\n```bash\n# Option 1: Direct file\nopen treeplexity.html\n\n# Option 2: Local server (for some features)\nnpx serve .\n```\n\n**Testing:**\n```bash\ncd test/treelisty-test\nnpm install\nnpm run test:unit    # 469 Mocha tests\n```\n\n**Deployment:**\n```bash\ngit add treeplexity.html\ngit commit -m \"Build XXX: Description\"\ngit push  # Netlify auto-deploys\n```\n\n**MCP Bridge (for Claude Code):**\n```bash\nnode packages/treelisty-mcp-bridge/src/bridge.js\n```"
        },
        {
          "id": "arch-key-locations",
          "name": "Key Code Locations",
          "description": "**By Line Number (approximate):**\n\n| Section | Lines | What's There |\n|---------|-------|--------------|\n| Header/Changelog | 1-1000 | Version history |\n| CSS Styles | 1000-11000 | All styling |\n| HTML Structure | 11000-14000 | Modals, views, layout |\n| Core Functions | 14000-20000 | render, save, load |\n| AI Integration | 15000-18000 | LLM calls, streaming |\n| TreeBeard | 55000-85000 | Chat, commands, tool use |\n| Canvas (GoJS) | 40000-50000 | 2D visualization |\n| Gantt (Frappe) | 50000-55000 | Timeline view |\n| Firebase Sync | 30000-35000 | Collaboration |\n\n**Key Searchable Patterns:**\n- `function render()` - tree view rendering\n- `COMMAND_REGISTRY` - all TB commands\n- `PATTERNS =` - pattern definitions\n- `TREELISTY_VERSION` - version info"
        },
        {
          "id": "arch-packages",
          "name": "Supporting Packages",
          "description": "**packages/**\n- `treelisty-mcp-bridge/` - Node.js MCP server for Claude Code\n- `treelisty-chrome-extension/` - Screen capture extension\n\n**netlify/functions/**\n- `claude-proxy.js` - Server-side API proxy (avoids CORS)\n\n**scripts/**\n- `measure-self-tree.js` - Gather codebase metrics\n- `generate-self-tree.js` - Create self-tree from measurements\n\n**test/**\n- `treelisty-test/` - Mocha unit tests (469)\n- `*.py` - Playwright e2e tests"
        }
      ]
    }
  ]
}